# 保存按钮和任务显示问题修复计划

## 问题分析

### 1. 保存按钮一直转圈问题
**根本原因**: TaskBloc初始化时存在竞争条件
- 构造函数中发送 `TaskLoadRequested` 事件
- 主应用创建时可能重复发送事件
- 导致BLoC状态卡在loading，保存按钮被禁用

**修复方案**: ✅ 已修复
- 只在TaskBloc构造函数中发送初始加载事件
- 主应用创建时不再重复发送事件
- 只在初始状态时显示loading，避免频繁loading状态

### 2. 任务无法实时显示问题
**根本原因**: 任务条显示逻辑正确，但可能存在数据加载问题
- BLoC状态管理可能不一致
- 任务创建后数据没有正确更新

**修复方案**: ✅ 已修复
- 确保任务创建后立即重新加载所有任务
- 使用ValueKey确保任务条widget稳定性
- 移除不必要的条件判断

## 已修复的代码

### TaskBloc修复
1. **初始化逻辑**: 只在构造函数中发送初始事件
2. **加载逻辑**: 只在初始状态时显示loading
3. **数据一致性**: 确保始终加载所有任务

### 主应用修复
1. **BLoC创建**: 移除重复的事件发送
2. **任务条显示**: 使用ValueKey确保稳定性

## 测试计划

### 简化版本测试 (http://localhost:8090)
- ✅ 正在运行
- ✅ 保存按钮正常工作
- ✅ 任务实时显示

### 复杂版本测试 (http://localhost:8088)
- ✅ 正在运行
- 🔄 需要测试保存按钮功能
- 🔄 需要测试任务实时显示

## 下一步行动
1. 热重载复杂版本应用修复
2. 测试保存按钮是否可以正常点击
3. 测试任务创建后是否实时显示
4. 如果问题依然存在，进一步调试BLoC状态流